---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.0
  name: metriccollectorreports.metric.kubernetes-fleet.io
spec:
  group: metric.kubernetes-fleet.io
  names:
    categories:
    - fleet
    - fleet-metrics
    kind: MetricCollectorReport
    listKind: MetricCollectorReportList
    plural: metriccollectorreports
    shortNames:
    - mcr
    singular: metriccollectorreport
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .workloadsMonitored
      name: Workloads
      type: integer
    - jsonPath: .lastCollectionTime
      name: Last-Collection
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          MetricCollectorReport is created by the MetricCollector controller on the hub cluster
          in the fleet-member-{clusterName} namespace to report collected metrics from a member cluster.
          The controller watches MetricCollector objects on the member cluster, collects metrics,
          and syncs the status to the hub as MetricCollectorReport objects.

          Controller workflow:
          1. MetricCollector reconciles and collects metrics on member cluster
          2. Metrics include clusterName from workload_health labels
          3. Controller creates/updates MetricCollectorReport in fleet-member-{clusterName} namespace on hub
          4. Report name matches MetricCollector name for easy lookup

          Namespace: fleet-member-{clusterName} (extracted from CollectedMetrics[0].ClusterName)
          Name: Same as MetricCollector name
          All metrics in CollectedMetrics are guaranteed to have the same ClusterName.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          collectedMetrics:
            description: |-
              CollectedMetrics contains the most recent metrics from each workload.
              All metrics are guaranteed to have the same ClusterName since they're collected from one member cluster.
            items:
              description: WorkloadMetrics represents metrics collected from a single
                workload pod.
              properties:
                clusterName:
                  description: ClusterName from the workload_health metric label.
                  type: string
                health:
                  description: Health indicates if the workload is healthy (true=healthy,
                    false=unhealthy).
                  type: boolean
                namespace:
                  description: Namespace is the namespace of the pod.
                  type: string
                workloadName:
                  description: WorkloadName from the workload_health metric label
                    (typically the deployment name).
                  type: string
              required:
              - clusterName
              - health
              - namespace
              - workloadName
              type: object
            type: array
          conditions:
            description: Conditions copied from the MetricCollector status.
            items:
              description: Condition contains details for one aspect of the current
                state of this API Resource.
              properties:
                lastTransitionTime:
                  description: |-
                    lastTransitionTime is the last time the condition transitioned from one status to another.
                    This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                  format: date-time
                  type: string
                message:
                  description: |-
                    message is a human readable message indicating details about the transition.
                    This may be an empty string.
                  maxLength: 32768
                  type: string
                observedGeneration:
                  description: |-
                    observedGeneration represents the .metadata.generation that the condition was set based upon.
                    For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                    with respect to the current state of the instance.
                  format: int64
                  minimum: 0
                  type: integer
                reason:
                  description: |-
                    reason contains a programmatic identifier indicating the reason for the condition's last transition.
                    Producers of specific condition types may define expected values and meanings for this field,
                    and whether the values are considered a guaranteed API.
                    The value should be a CamelCase string.
                    This field may not be empty.
                  maxLength: 1024
                  minLength: 1
                  pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                  type: string
                status:
                  description: status of the condition, one of True, False, Unknown.
                  enum:
                  - "True"
                  - "False"
                  - Unknown
                  type: string
                type:
                  description: type of condition in CamelCase or in foo.example.com/CamelCase.
                  maxLength: 316
                  pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                  type: string
              required:
              - lastTransitionTime
              - message
              - reason
              - status
              - type
              type: object
            type: array
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          lastCollectionTime:
            description: LastCollectionTime is when metrics were last collected on
              the member cluster.
            format: date-time
            type: string
          lastReportTime:
            description: LastReportTime is when this report was last synced to the
              hub.
            format: date-time
            type: string
          metadata:
            type: object
          observedGeneration:
            description: ObservedGeneration is the generation most recently observed
              from the MetricCollector.
            format: int64
            type: integer
          workloadsMonitored:
            description: WorkloadsMonitored is the count of workloads being monitored.
            format: int32
            type: integer
        type: object
    served: true
    storage: true
    subresources: {}
